<!DOCTYPE html>
<html>


<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
    <meta name="description" content="">
    <meta property="og:url"           content="https://leetintelligence.com/LEETAPP/map.html" />
    <meta property="og:type"          content="website" />
    <meta property="og:title"         content="LEETintelligence Covid Alert" />
    <meta property="og:description"   content="Get Data" />
  
    <title>Covid-19 Maps</title>

    <!-- Load HERE API Code Libraries-->
    <link rel="stylesheet" type="text/css" href="https://js.api.here.com/v3/3.1/mapsjs-ui.css" />
    <script type="text/javascript" src="https://js.api.here.com/v3/3.1/mapsjs-core.js"></script>
    <script type="text/javascript" src="https://js.api.here.com/v3/3.1/mapsjs-service.js"></script>
    <script type="text/javascript" src="https://js.api.here.com/v3/3.1/mapsjs-ui.js"></script>
    <script type="text/javascript" src="https://js.api.here.com/v3/3.1/mapsjs-mapevents.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.3.1.js"></script>
    <script type="text/javascript" src="https://canvasjs.com/assets/script/jquery.canvasjs.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.min.css" />

    <!-- HERE credentials -->
    <!-- <script src="credentials.js"></script> -->

    <!--     Fonts and icons     -->
    <link rel="stylesheet" type="text/css"
        href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:400,700|Material+Icons" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" />


    <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>-->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/0.71/jquery.csv-0.71.min.js"></script> -->

    <link href="assets/css/bootstrap.min.css" rel="stylesheet" />
    <link href="assets/css/material-kit.css?v=1.2.1" rel="stylesheet" />
    <script src="assets/js/material-kit.js?v=1.2.1" type="text/javascript"></script>
    <script src="assets/Chart.min.js"></script>
    <script src="assets/utils.js"></script>

    <style>
        .map {
            height: 70vh;
        }

        .orangefont {
            color: orange;
        }

        .greenfont {
            color: green;
        }

        .redfont {
            color: red;
        }

        .fa.fa-instagram {
            color: transparent;
            background: radial-gradient(circle at 30% 107%, #fdf497 0%, #fdf497 5%, #fd5949 45%, #d6249f 60%, #285AEB 90%);
            background: -webkit-radial-gradient(circle at 30% 107%, #fdf497 0%, #fdf497 5%, #fd5949 45%, #d6249f 60%, #285AEB 90%);
            background-clip: text;
            -webkit-background-clip: text;
        }
    </style>

</head>

<body class="body">
    <!--navrbar-rose:#171516;-->
    <div id="navbarjs"></div>
    <div class="section-space"></div>
    <div id="map" class="map"></div>
    <div class="container" id="contenttab">
        <div class="row">
            <ul class="nav nav-pills  nav-pills-icons nav-pills-danger" role="tablist">
                <!--
                            color-classes: "nav-pills-primary", "nav-pills-info", "nav-pills-success", "nav-pills-warning","nav-pills-danger"
                        -->
                <li class="active">
                    <a href="#worldtab" role="tab" data-toggle="tab" aria-expanded="true"
                        onclick="TodayGraphToggleW();">
                        <i class="material-icons">dashboard</i>
                        World
                    </a>
                </li>
                <li class="">
                    <a href="#todaytab" role="tab" data-toggle="tab" aria-expanded="false"
                        onclick="TodayGraphToggle();">
                        <i class="material-icons">schedule</i>
                        Today
                    </a>
                </li>
                <li class="" onclick="RedirectP();">
                    <a role="tab" data-toggle="tab" aria-expanded="false">
                        <i class="material-icons">assignment</i>
                        Get Tested
                    </a>
                </li>
                <li class="" onclick="RedirectH();">
                    <a role="tab" data-toggle="tab" aria-expanded="false">
                        <i class="material-icons">local_hospital</i>
                        Hospital
                    </a>
                </li>
            </ul>
            <div class="tab-content tab-space">
                <div class="tab-pane active" id="worldtab">
                    <div class="row">
                        <div class="col-xs-4" id="confirm" style="color: orange;">

                        </div>
                        <div class="col-xs-4" id="recover" style="color: #2eb8b8;">

                        </div>
                        <div class="col-xs-4" id="deaths" style="color: red;">

                        </div>
                    </div>
                    <div class="row">
                        <canvas id="worldgraph"></canvas>
                    </div>
                </div>
                <div class="tab-pane" id="todaytab">
                    <div class="row">
                        <div class="col-xs-4" id="tconfirm" style="color: orange;">

                        </div>
                        <div class="col-xs-4" id="trecover" style="color: #2eb8b8;">

                        </div>
                        <div class="col-xs-4" id="tdeaths" style="color: red;">

                        </div><br>
                        <center><b id="lastdate"></b></center>
                    </div>
                </div>
            </div>
        </div>
        <div class="row" id="todaytabgraph">
            <div id="chartContainer" style="height: 300px; width: 100%;"></div><br><br>
        </div>
        <div class="row" id="covidtablerow">
            <table id="covidtable" class="display" style="width:100%"></table>
        </div>
        <div class="row" id="covidtabletodayrow">
            <table id="covidtabletoday" class="display" style="width:100%"></table>
        </div>

        <div class="row" id="markermodel">
            <div class="modal" id="myModal">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-body">
                            <b>
                                <center id="cntryname"></center>
                            </b>
                            <canvas id="worldgraph0"></canvas>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-success"
                                onclick="JSONToCSVConvertor();">Export</button>
                            <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="modal" id="signupModal">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-body">
                            <h3 class="modal-title card-title text-center" id="myModalLabel">COV19-LA</h3>
                            <div onclick="DirectToURL('T');" style="cursor: pointer;">
                                <div class="description">

                                    <h4 class="info-title">
                                        <center>
                                            Should I Get Tested to Prevent<br>
                                            <h3>
                                                <div class="icon icon-rose">
                                                    <i class="fa fa-plus"></i>
                                                    GET TESTED
                                                </div>
                                            </h3>

                                        </center>
                                    </h4>
                                </div>

                            </div>

                            <h4 class="modal-title card-title text-center" id="myModalLabel">Register</h4>
                            <h5>*The Registration only for hospital and Checkpoints </h5>
                            <div>
                                <div class="description">
                                    <h4 class="info-title">
                                        <center>Should I help to Save lives</center><br>
                                        <div class="row">
                                            <div class="col-sm-6" onclick="DirectToURL('H');" style="cursor: pointer;">
                                                <center>
                                                    <h3>
                                                        <div class="icon icon-primary">
                                                            <i class="fa fa-hospital-o"></i>
                                                            Hospital
                                                        </div>
                                                    </h3>
                                                </center>
                                            </div>
                                            <div class="col-sm-6" onclick="DirectToURL('C');" style="cursor: pointer;">
                                                <center>
                                                    <h3>
                                                        <div class="icon icon-info">
                                                            <i class="fa fa-check"></i>
                                                            Checkpoint
                                                        </div>
                                                    </h3>
                                                </center>
                                            </div>
                                        </div>

                                    </h4>
                                </div>
                            </div>

                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-rose" data-dismiss="modal">Close</button>
                        </div>

                    </div>
                </div>
            </div>
        </div>


        <div class="row">
            <div class="modal" id="supportus">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-body">
                            <h2 class="modal-title card-title text-center" id="myModalLabel">Support US</h2>
                            <div class="description">
                                <h4 class="info-description">
                                    Our COV19-LA Mobile APP and COVID Map is a labor of love. We offer it free of
                                    charge. But we do have expenses for website hosting and storage and other
                                    essentials like utilities, office supplies, rent…you know how it is. We could
                                    use your support.
                                    <br><br>
                                    Subscribe to our monthly bulletin through <a style="color: blue;"
                                        href="https://www.patreon.com/LEETintelligence">Patreon</a>
                                    <br><br>
                                    Have you got an idea for using location-based data in your business or profession?
                                    As a Tier 3 subscriber, you get free consultations with me to help you bring your
                                    vision to life.
                                    <br><br>
                                    Please share this website and APP with your loved ones, family, and friends to
                                    prevent the spread of COVID-19, flatten the curve, and save lives.
                                </h4>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-rose" data-dismiss="modal">Close</button>
                        </div>
                    </div>


                </div>
            </div>
        </div>

        <div class="modal fade in" id="signupModal1">
            <div class="modal-dialog modal-signup">
                <div class="modal-content">
                    <div class="card card-signup card-plain">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><i
                                    class="material-icons">clear</i></button>
                            <h2 class="modal-title card-title text-center" id="myModalLabel">COV19-LA</h2>
                        </div>
                        <div class="modal-body">
                            <div class="row">
                                <div class="info info-horizontal" onclick="DirectToURL('T');">
                                    <div class="icon icon-rose">
                                        <i class="fa fa-plus"></i>
                                    </div>
                                    <div class="description">
                                        <h4 class="info-title">GET TESTED</h4>
                                        <p class="description">
                                            Get Tested
                                        </p>
                                    </div>
                                </div>
                                <center>
                                    <h4>*The Registration only for hospital and Checkpoints </h4>
                                </center>
                                <div class="row">
                                    <div class="col-sm-6">
                                        <center>
                                            <div onclick="DirectToURL('H');">
                                                <div class="icon icon-primary">
                                                    <i class="fa fa-hospital-o"></i>
                                                </div>
                                                <div class="description">
                                                    <h4 class="info-title">HOSPITAL</h4>
                                                    <p class="description">
                                                        Register Hospital
                                                    </p>
                                                </div>
                                            </div>
                                        </center>
                                    </div>
                                    <div class="col-sm-6">
                                        <div class="info info-horizontal" onclick="DirectToURL('C');">
                                            <div class="icon icon-info">
                                                <i class="fa fa-check"></i>
                                            </div>
                                            <div class="description">
                                                <h4 class="info-title">CHECKPOINT</h4>
                                                <p class="description">
                                                    Register CheckPoint
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>






                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
    <div style="position: fixed; bottom: 2.5em; right: 2em; z-index: 1000;">
        <div class="fb-share-button" 
        data-href="https://leetintelligence.com/LEETAPP/map.html" 
        data-layout="button_count">
      </div>
        <!-- <i class="fa fa-facebook-square fa-3x" style="color: #3b5998; cursor: pointer;" ></i>
        <script>
            function OpenFacebook() {
             // alert("Facebook");
            }
        </script> -->
          <script>(function(d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) return;
            js = d.createElement(s); js.id = id;
            js.src = "https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.0";
            fjs.parentNode.insertBefore(js, fjs);
          }(document, 'script', 'facebook-jssdk'));</script>
    </div>
    <!-- <div style="position: fixed; bottom: 2.5em; right: 3em; z-index: 1000;">
        <i class="fa fa-instagram fa-3x" style="cursor: pointer;"></i>
        <script>
            function OpenInstagram() {
              
                //window.open("#", '_blank', "width=500,height=800,left=" + screenwidth);
            }
        </script>
    </div> -->
    <!--     *********    BIG FOOTER     *********      -->

    <div id="footerjs"></div>
    <!--     *********   END BIG FOOTER     *********      -->

    <script src="navbar.js"></Script>
    <Script src="footer.js"></Script>
    <script>
        document.getElementById('navbarjs').innerHTML = navbarcontain;
        document.getElementById('footerjs').innerHTML = footercontain;

    </script>
    <script>
        var confirmed, recovered, deaths, lastdate, defaultLat, defaultLng;
        var recoveredfinal = []
        var dataset1 = [];
        var dataset2 = [];
        var datasetToday = [];
        var datasetcount = 0;
        var ExportTemp, ExportCntry;
        const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];

        function DirectToURL(valURL) {
            if (valURL == 'T') location.href = "https://leetintelligence.com/LEETAPP/UserInput.html";
            if (valURL == 'H') location.href = "https://leetintelligence.com/LEETAPP/HospitalRegistration.html";
            if (valURL == 'C') location.href = "https://leetintelligence.com/LEETAPP/CheckpointRegistration.html";

        }
        //Web Lat and Lng
        function findCurrentPosition() {
            function success(position) {
                defaultLat = parseFloat(position.coords.latitude);
                defaultLng = parseFloat(position.coords.longitude);

                localStorage.setItem("lat", defaultLat);
                localStorage.setItem("lng", defaultLng);

                //console.log(defaultLat+" == "+defaultLng);
            }
            function error() {
                alert("Unable to retrieve your location");
                //document.getElementById('current_position').innerHTML = '<h4>Your position</h4>Unable to retrieve your location';
            }
            if (!navigator.geolocation) {
                alert("Geolocation is not supported by your browser");
                // document.getElementById('current_position').innerHTML = '<h3>Your position</h3>Geolocation is not supported by your browser';
            } else {
                //document.getElementById('current_position').innerHTML = '<h3>Your position</h3>Locating…';
                navigator.geolocation.getCurrentPosition(success, error);
            }
        }

        //Mobile Lat and Lng
        var url_string = window.location.href;
        var url = new URL(url_string);
        var lat = parseFloat(url.searchParams.get("lat"));
        var lng = parseFloat(url.searchParams.get("lng"));
        if (lat && lng) {
            defaultLat = lat,
                defaultLng = lng;
        } else {
            defaultLat = 14.075949,
                defaultLng = 100.614844;
            findCurrentPosition();
        }
        defaultLat = 13.790413;
        defaultLng = 100.5472191;
        localStorage.setItem("lat", defaultLat);
        localStorage.setItem("lng", defaultLng);
        //Set Navbar items
        $('#clamp').attr('href', 'UserNearBy.html?lat=' + defaultLat + "&lng=" + defaultLng);
        $('#hmap').attr('href', 'HospitalNearBy.html?lat=' + defaultLat + "&lng=" + defaultLng);
        $('#uefmap').attr('href', 'UserInput.html?lat=' + defaultLat + "&lng=" + defaultLng);

        //HERE credentials - https://developer.here.com - manjursgee@gmail.com - Freemium - Transactions per month 250K
        var JS_APIKEY = 'mFIKL7_dKD4sTrqcvxdg6hpKw8x8yz9aOetOQV-_PYE',
            REST_APIKEY = 'Pvk8ZMAwP_NHHans8F_XURDu8XYiHC_UYewt1bKTX1A';

        //source https://github.com/CSSEGISandData/COVID-19/tree/master/csse_covid_19_data/csse_covid_19_time_series
        //confirmed https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_global.csv
        //recovered https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_recovered_global.csv 
        //deaths https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_global.csv
        //var confirmed,recovered,deaths;
        //Run this function first to get all data from the sources
        getData();

        async function getData() {



            await $.ajax({
                type: 'GET',
                url: 'https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_global.csv',
                dataType: 'text',
                success: function (response) {
                    confirmed = $.csv.toArrays(response);
                    confirmedv = $.csv.toArrays(response); // to avoid pass by reference problem
                    for (var confirmedvi = 4; confirmedvi < confirmedv[0].length; confirmedvi++) {
                        TempC = confirmedv[0][confirmedvi].split('/');
                        confirmedv[0][confirmedvi] = TempC[0] + "/" + TempC[1];
                    }
                }
            });

            await $.ajax({
                type: 'GET',
                url: 'https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_recovered_global.csv',
                dataType: 'text',
                success: function (response) {
                    recovered = $.csv.toArrays(response);
                    recoveredv = $.csv.toArrays(response); // to avoid pass by reference problem
                }
            });

            await $.ajax({
                type: 'GET',
                url: 'https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_global.csv',
                dataType: 'text',
                success: function (response) {
                    deaths = $.csv.toArrays(response);
                    deathsv = $.csv.toArrays(response); // to avoid pass by reference problem
                }
            });

            //Update World Section
            $('#confirm').append('<h3><b>' + numberWithCommas(getSum(confirmed)[0]) + '</b><br>Confirmed</h3>');
            $('#recover').append('<h3><b>' + numberWithCommas(getSum(recovered)[0]) + '</b><br>Recovered</h3>');
            $('#deaths').append('<h3><b>' + numberWithCommas(getSum(deaths)[0]) + '</b><br>Deaths</h3>');
            //Update Today Section
            $('#tconfirm').append('<h3><b>' + numberWithCommas(getSum(confirmed)[1]) + '</b><br>Confirmed</h3>');
            $('#trecover').append('<h3><b>' + numberWithCommas(Math.abs(getSum(recovered)[1])) + '</b><br>Recovered</h3>');
            $('#tdeaths').append('<h3><b>' + numberWithCommas(getSum(deaths)[1]) + '</b><br>Deaths</h3>');
            //Last updated date
            lastdatetemp = confirmed[0][confirmed[0].length - 1].split("/");
            lastmonth = monthNames[Number(lastdatetemp[0]) - 1];
            lastdate = lastdatetemp[1] + "-" + lastmonth + "-" + lastdatetemp[2];
            $('#lastdate').append(lastdate);

            UpdateTodayGraph(getSum(confirmed)[1], getSum(recovered)[1], getSum(deaths)[1]);
            //console.log('heeeree');
            //console.log(getSumArray(confirmed));
            config.data.labels = confirmedv[0].slice(4, confirmedv[0].length);
            config.data.datasets[0].data = getSumArray(confirmedv);
            config.data.datasets[1].data = getSumArray(recoveredv);
            config.data.datasets[2].data = getSumArray(deathsv);
            config.options.title.text = lastdate;
            //Then get all data, pass all the data to the function addMarkerToMap for show all data as markers on the map
            await addMarkerToMap(confirmed, recovered, deaths);
            window.myLine.update();

            $('#covidtable').DataTable({
                data: dataset2,
                columns: [
                    { title: "Country" },
                    { title: "Confirmed" },
                    { title: "Recovered" },
                    { title: "Deaths" }
                ],
                "order": [[1, "desc"]]
            });

            $('#covidtabletoday').DataTable({
                data: datasetToday,
                columns: [
                    { title: "Country" },
                    { title: "Confirmed" },
                    { title: "Recovered" },
                    { title: "Deaths" }
                ],
                "order": [[1, "desc"]]
            });

            // for(var i=1; i<confirmed.length;i++){
            //     var province_state = confirmed[i][0];
            //     var country_region = confirmed[i][1];

            //     for(var j=1; j<recovered.length;j++){
            //         if (recovered[j][0] == province_state && recovered[j][1] == country_region) {
            //             recoveredfinal[i]=recovered[j];
            //         }
            //         else recoveredfinal[i]=new Array(confirmed[i].length).fill(0);
            //     }
            // }
            // console.log("heeerree");
            // console.log(recoveredfinal);

        }

        function getSum(Arr) {
            var countSum = 0;
            var countSumToday = 0;
            ArrTemp = [];
            for (var i = 1; i < Arr.length; i++) {
                countSum = countSum + Number(Arr[i][Arr[i].length - 1]);
                countSumToday = countSumToday + Number(Arr[i][Arr[i].length - 2]);
            }
            ArrTemp[0] = countSum; //World
            ArrTemp[1] = countSum - countSumToday; //Today
            return ArrTemp;
        }

        function getSumArray(Arr) {
            for (var i = 2; i < Arr.length; i++) {
                for (var j = 4; j < Arr[0].length; j++) {
                    Arr[1][j] = Number(Arr[1][j]) + Number(Arr[i][j]);
                }
            }
            return Arr[1].slice(4, Arr[1].length);
        }

        //Below is the function for create markers and info bubbles

        //Grouping pins and text together
        var groupMarker = new H.map.Group();

        //Info bubbles
        groupMarker.addEventListener('tap', function (evt) {
            var bubble = new H.ui.InfoBubble(evt.target.getGeometry(), {
                content: evt.target.getData()
            });
            //remove info bubble
            ui.getBubbles().forEach(bub => ui.removeBubble(bub));
            // show info bubble
            ui.addBubble(bubble);
        }, false);



        //Circle marker in SVG
        // var svgMarkup = '<svg version="1.1" xmlns="http://www.w3.org/2000/svg" height="48" width="48"><circle cx="24" cy="24" r="20" stroke="white" stroke-width="4" fill="${color}" /><text x="50%" y="50%" fill="black" dominant-baseline="middle" text-anchor="middle">${num}</text></svg>';
        var svgMarkup = '<svg version="1.1" xmlns="http://www.w3.org/2000/svg" height="48" width="48"><circle cx="24" cy="24" r="24" fill="${color}" fill-opacity="70%" /><text x="50%" y="50%" fill="black" dominant-baseline="middle" text-anchor="middle">${num}</text></svg>';
        //Markers
        function addMarker(icon, coordinate, html) {
            map.addObject(groupMarker);
            var marker = new H.map.Marker(coordinate, { icon: icon });
            marker.setData(html);
            groupMarker.addObject(marker);
        }

        var modelid = 0;
        //Add markers to map
        function addMarkerToMap(confirmed, recovered, deaths) {
            //console.log(confirmed);
            var Zerofill = new Array(confirmed[2].length).fill(0);
            for (var i = 1; i < confirmed.length; i++) {
                var num = confirmed[i][confirmed[0].length - 1]; //Latest confirmed cases (last column)
                var numToday = num - confirmed[i][confirmed[0].length - 2];

                var color = numToColorLevel(num);
                var numK = numToK(num);

                var province_state = confirmed[i][0];
                var country_region = confirmed[i][1];
                var lat = confirmed[i][2];
                var lng = confirmed[i][3];

                //The number of records between the 3 data series are not equal.
                //So I'm using the first 2 columns (Province/State-array0, Country/Region-array1) as the composite keys.
                //The main table is time_series_covid19_confirmed_global.csv
                var numConfirmed;
                var check = 0;
                for (var j = 1; j < recovered.length; j++) {
                    if (recovered[j][0] == province_state && recovered[j][1] == country_region) {
                        recoveredfinal.push(recovered[j]);
                        check = 1;
                        numConfirmed = recovered[j][recovered[0].length - 1];
                        numConfirmedToday = numConfirmed - recovered[j][recovered[0].length - 2];
                    }
                }
                if (check == 0) recoveredfinal.push(Zerofill);

                var numDeaths;
                for (var k = 1; k < deaths.length; k++) {
                    if (deaths[k][0] == province_state && deaths[k][1] == country_region) {
                        numDeaths = deaths[k][deaths[0].length - 1];
                        numDeathsToday = numDeaths - deaths[k][deaths[0].length - 2];
                    }
                }

                // Not including the cruise ships: Diamond Princess, MS Zaandam (lat = 0, lng = 0).
                // Due to the data source didn't provide lat/lng.
                if (lat != 0 && lng != 0) {
                    //Update Table
                    //$('#covidtablebody').append('<tr><td>' + province_state + " " + country_region + '</td><td style="color:orange">' + num + '</td><td style="color:green">' + numConfirmed + '</td><td style="color:red">' + numDeaths + '</td><tr>');
                    dataset2[datasetcount] = [province_state + " " + country_region, numberWithCommas(num), numberWithCommas(numConfirmed), numberWithCommas(numDeaths)];
                    datasetToday[datasetcount] = [province_state + " " + country_region, numToday, numConfirmedToday, numDeathsToday];
                    datasetcount++;

                    // var icon = new H.map.Icon(svgMarkup.replace('${markerRadius}', markerRadius).replace('${markerWidth}', markerWidthHeight).replace('${markerHeight}', markerWidthHeight).replace('${markerCx}', markerRadius).replace('${markerCy}', markerRadius), { anchor: { x: markerRadius, y: markerRadius } });
                    var icon = new H.map.Icon(svgMarkup.replace('${color}', color).replace('${num}', numK), { anchor: { x: 24, y: 24 } });
                    // addMarker(icon, { lat: lat, lng: lng },
                    //     '<div style="white-space: nowrap">'
                    //     + '<span>Province/State: ' + province_state + '</span><br>'
                    //     + '<span>Country/Region: ' + country_region + '</span><br>'
                    //     + '<button data-toggle="modal" style="font-size: 10px;" onclick="TodayGraph(' + i + ')">View Graph</button>'
                    //     + '<hr>'
                    //     + '<span class="orangefont">Confirmed: ' + num + '</span><br>'
                    //     + '<span class="greenfont">Recovered: ' + numConfirmed + '</span><br>'
                    //     + '<span class="redfont">Deaths: ' + numDeaths + '</span>'
                    //     + '</div>'
                    // );
                    if (province_state) province_state = " / " + province_state
                    //var Tval = {index: i, country: country_region, province:province_state}
                    addMarker(icon, { lat: lat, lng: lng },
                        '<div style="white-space: nowrap">'
                        + '<span>' + country_region + '' + province_state + '</span><br>'
                        + '<button data-toggle="modal" style="font-size: 10px;" onclick="TodayGraph(' + i + ')">View Graph</button>'
                        + '<hr>'
                        + '<span class="orangefont">Confirmed: ' + num + '</span><br>'
                        + '<span class="greenfont">Recovered: ' + numConfirmed + '</span><br>'
                        + '<span class="redfont">Deaths: ' + numDeaths + '</span>'
                        + '</div>'
                    );
                }

            }

            // map.getViewModel().setLookAtData({
            //   bounds: groupMarker.getBoundingBox()
            // });
        }

        //Symbolize the markers by number of the latest confirmed cases
        function numToColorLevel(num) {
            if (num <= 10) {
                color = 'LightBlue';
            } else if (num > 10 && num <= 100) {
                color = 'LightGreen';
            } else if (num > 100 && num <= 1000) {
                color = 'Yellow';
            } else if (num > 1000 && num <= 10000) {
                color = 'Orange';
            } else if (num > 10000 && num <= 100000) {
                color = 'OrangeRed';
            } else if (num > 100000) {
                color = 'Red';
            }
            return color;
        }

        function numToK(num) {
            if (num <= 999) {
                numK = num;
            } else if (num > 999) {
                numK = (num / 1000);
                numK = numK.toFixed(0);
                numK = numK + 'K'
            }
            return numK;
        }


        //Below is the general scripts of interactive map

        /**
         * Boilerplate map initialization code starts below:
         */

        //Step 1: initialize communication with the platform
        // In your own code, replace variable window.apikey with your own apikey
        var platform = new H.service.Platform({
            apikey: JS_APIKEY
        });
        var defaultLayers = platform.createDefaultLayers();

        //Step 2: initialize a map - this map is centered over Europe
        var map = new H.Map(document.getElementById('map'),
            defaultLayers.vector.normal.map, {
            center: { lat: defaultLat, lng: defaultLng },
            zoom: 5,
            pixelRatio: window.devicePixelRatio || 1
        });
        // add a resize listener to make sure that the map occupies the whole container
        window.addEventListener('resize', () => map.getViewPort().resize());

        //Step 3: make the map interactive
        // MapEvents enables the event system
        // Behavior implements default interactions for pan/zoom (also on mobile touch environments)
        var behavior = new H.mapevents.Behavior(new H.mapevents.MapEvents(map));

        // Create the default UI components
        var ui = H.ui.UI.createDefault(map, defaultLayers);

        // Remove not needed settings control
        ui.removeControl('mapsettings');

        // Now use the map as required...

        setBaseLayer(map, platform);
        function setBaseLayer(map, platform) {
            var mapTileService = platform.getMapTileService({
                type: 'base'
            });
            var parameters = {};
            var tileLayer = mapTileService.createTileLayer(
                'maptile',
                'reduced.day', //change scheme here 
                256,
                'png8',
                parameters
            );
            map.setBaseLayer(tileLayer);
        }

    // normal.day
    // normal.day.grey
    // normal.day.transit
    // normal.day.custom
    // normal.night
    // normal.night.grey
    // pedestrian.day
    // pedestrian.day.mobile
    // pedestrian.night
    // pedestrian.night.mobile
    // carnav.day.grey
    // normal.day.mobile
    // normal.day.grey.mobile
    // normal.day.transit.mobile
    // normal.night.mobile
    // normal.night.grey.mobile
    // reduced.day
    // reduced.night
    // normal.traffic.day
    // normal.traffic.night
    // normal.night.transit
    // normal.night.transit.mobile
    </script>

    <!--Graph-->
    <script>
        var MONTHS = [];
        var config = {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'Confirmed',
                    backgroundColor: window.chartColors.orange,
                    borderColor: window.chartColors.orange,
                    data: [],
                    fill: false,
                }, {
                    label: 'Recovered',
                    fill: false,
                    backgroundColor: window.chartColors.green,
                    borderColor: window.chartColors.green,
                    data: [],
                }, {
                    label: 'Deaths',
                    fill: false,
                    backgroundColor: window.chartColors.red,
                    borderColor: window.chartColors.red,
                    data: [],
                }]
            },
            options: {
                responsive: true,
                title: {
                    display: true,
                    text: ''
                },
                tooltips: {
                    mode: 'index',
                    intersect: false,
                },
                hover: {
                    mode: 'nearest',
                    intersect: true
                },
                scales: {
                    xAxes: [{
                        display: true,
                        scaleLabel: {
                            display: true,
                            labelString: 'Time Series'
                        }
                    }],
                    yAxes: [{
                        display: true,
                        scaleLabel: {
                            display: true,
                            labelString: 'Cases'
                        },
                        ticks: {
                            // Abbreviate the millions
                            callback: function (value, index, values) {
                                return value / 1e6 + 'M';
                            }
                        }
                    }]
                }
            }
        };

        //Only one Country Graph
        var MONTHSm = [];
        var configm = {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'Confirmed',
                    backgroundColor: window.chartColors.orange,
                    borderColor: window.chartColors.orange,
                    data: [],
                    fill: false,
                }, {
                    label: 'Recovered',
                    fill: false,
                    backgroundColor: window.chartColors.green,
                    borderColor: window.chartColors.green,
                    data: [],
                }, {
                    label: 'Deaths',
                    fill: false,
                    backgroundColor: window.chartColors.red,
                    borderColor: window.chartColors.red,
                    data: [],
                }]
            },
            options: {
                responsive: true,
                title: {
                    display: true,
                    text: ''
                },
                tooltips: {
                    mode: 'index',
                    intersect: false,
                },
                hover: {
                    mode: 'nearest',
                    intersect: true
                },
                scales: {
                    xAxes: [{
                        display: true,
                        scaleLabel: {
                            display: true,
                            labelString: 'Time Series'
                        }
                    }],
                    yAxes: [{
                        display: true,
                        scaleLabel: {
                            display: true,
                            labelString: 'Cases'
                        },
                        ticks: {
                            // Abbreviate the millions
                            callback: function (value, index, values) {
                                return value / 1000 + 'k';
                            }
                        }
                    }]
                }
            }
        };

        window.onload = function () {
            var ctx = document.getElementById('worldgraph').getContext('2d');
            window.myLine = new Chart(ctx, config);
            var ctx1 = document.getElementById('worldgraph0').getContext('2d');
            window.myLine1 = new Chart(ctx1, configm);
        };
    </script>
    <script>
        function TodayGraph(Tindex) {
            /* alert(Tindex);
             console.log(Tindex); */
            //alert(confirmed[Tindex][0]);
            //console.log(recoveredfinal);
            // $('#cntryname').remove();
            var ExportArr = [];
            $('#cntryname').empty().append(confirmed[Tindex][1]);
            configm.data.labels = confirmedv[0].slice(4, confirmedv[0].length);
            configm.data.datasets[0].data = confirmed[Tindex].slice(4, confirmed[Tindex].length);
            configm.data.datasets[1].data = recoveredfinal[Tindex - 1].slice(4, recoveredfinal[Tindex - 1].length);
            configm.data.datasets[2].data = deaths[Tindex].slice(4, deaths[Tindex].length);
            //configm.options.yAxes.ticks
            for (var ei = 0; ei < configm.data.labels.length; ei++) {
                ExportArr.push({ "Date": configm.data.labels[ei], "Confirmed": configm.data.datasets[0].data[ei], "Recovered": configm.data.datasets[1].data[ei], "Deaths": configm.data.datasets[2].data[ei] });
            }
            //ExportArr.push
            /*console.log(configm.data.labels);
            console.log(configm.data.datasets[0].data);
            console.log(configm.data.datasets[1].data);
            console.log(configm.data.datasets[2].data);
            console.log(ExportArr);*/
            //JSONToCSVConvertor(ExportArr, confirmed[Tindex][1], true);
            ExportTemp = ExportArr;
            ExportCntry = confirmed[Tindex][1];
            window.myLine1.update();
            $('#myModal').modal('show');
        }
    </script>
    <script>
        function UpdateTodayGraph(confirmedToday, RecoveredToday, DeathsToday) {


            //Better to construct options first and then pass it as a parameter
            var options = {
                animationEnabled: true,
                title: {
                    text: lastdate,
                    fontColor: "Peru"
                },
                axisY: {
                    tickThickness: 0,
                    lineThickness: 0,
                    valueFormatString: " ",
                    gridThickness: 0
                },
                axisX: {
                    tickThickness: 0,
                    lineThickness: 0,
                    labelFontSize: 10,
                    labelFontColor: "Peru"
                },
                data: [{
                    indexLabelFontSize: 10,
                    toolTipContent: "<span style=\"color:#CD853F\">{indexLabel}:</span> <span style=\"color:#CD853F\"><strong>{y}</strong></span>",
                    indexLabelPlacement: "inside",
                    indexLabelFontColor: "white",
                    indexLabelFontWeight: 200,
                    indexLabelFontFamily: "Verdana",
                    color: "#62C9C3",
                    type: "bar",
                    dataPoints: [
                        { y: DeathsToday, label: DeathsToday, indexLabel: "Deaths", color: "red" },
                        { y: RecoveredToday, label: RecoveredToday, indexLabel: "Recovered", color: "#2eb8b8" },
                        { y: confirmedToday, label: confirmedToday, indexLabel: "Confirmed", color: "orange" }

                    ]
                }]
            };

            $("#chartContainer").CanvasJSChart(options);
            $('#todaytabgraph').hide(); //initial load
            $('#covidtabletodayrow').hide(); //initial load

        }

        function TodayGraphToggle() {
            // $('#todaytabgraph').show();
            $('#covidtabletodayrow').show();
            $('#covidtablerow').hide();
        }
        function TodayGraphToggleW() {
            //  $('#todaytabgraph').hide();
            $('#covidtabletodayrow').hide();
            $('#covidtablerow').show();
        }

    </script>
    <!--Add comma to the number-->
    <script>
        function numberWithCommas(number) {
            var parts = number.toString().split(".");
            parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            return parts.join(".");
        }
    </script>

    <script>
        //Add lat and lng here-------------------------
        function RedirectP() {
            location.href = "https://leetintelligence.com/LEETAPP/UserInput.html";
        }
        function RedirectH() {
            location.href = "https://leetintelligence.com/LEETAPP/HospitalNearBy.html";
        }
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/0.71/jquery.csv-0.71.min.js"></script>
    <script src="assets/js/bootstrap.min.js" type="text/javascript"></script>

    <script>



        function JSONToCSVConvertor() {
            JSONData = ExportTemp;
            ReportTitle = ExportCntry;
            ShowLabel = true;
            //If JSONData is not an object then JSON.parse will parse the JSON string in an Object
            var arrData = typeof JSONData != 'object' ? JSON.parse(JSONData) : JSONData;

            var CSV = '';
            //Set Report title in first row or line

            CSV += ReportTitle + '\r\n\n';

            //This condition will generate the Label/Header
            if (ShowLabel) {
                var row = "";

                //This loop will extract the label from 1st index of on array
                for (var index in arrData[0]) {

                    //Now convert each value to string and comma-seprated
                    row += index + ',';
                }

                row = row.slice(0, -1);

                //append Label row with line break
                CSV += row + '\r\n';
            }

            //1st loop is to extract each row
            for (var i = 0; i < arrData.length; i++) {
                var row = "";

                //2nd loop will extract each column and convert it in string comma-seprated
                for (var index in arrData[i]) {
                    row += '"' + arrData[i][index] + '",';
                }

                row.slice(0, row.length - 1);

                //add a line break after each row
                CSV += row + '\r\n';
            }

            if (CSV == '') {
                alert("Invalid data");
                return;
            }

            //Generate a file name
            var fileName = "MyReport_";
            //this will remove the blank-spaces from the title and replace it with an underscore
            fileName += ReportTitle.replace(/ /g, "_");

            //Initialize file format you want csv or xls
            var uri = 'data:text/csv;charset=utf-8,' + escape(CSV);

            // Now the little tricky part.
            // you can use either>> window.open(uri);
            // but this will not work in some browsers
            // or you will not get the correct file extension    

            //this trick will generate a temp <a /> tag
            var link = document.createElement("a");
            link.href = uri;

            //set the visibility hidden so it will not effect on your web-layout
            link.style = "visibility:hidden";
            link.download = fileName + ".csv";

            //this part will append the anchor tag and remove it after automatic click
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

       // $('#signupModal').modal('show');

    </script>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-166797509-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'UA-166797509-1');
    </script>
    <script type="text/javascript" id="cookieinfo" 
    data-message="By continuing to use our site you consent to the use of cookies as described in our" 
    data-linkmsg="privacy policy." 
    data-moreinfo="https://leetintelligence.com/privacypolicy.html"
    data-close-text="Accept and Close"
	src="//cookieinfoscript.com/js/cookieinfo.min.js">
</script>


</body>

</html>